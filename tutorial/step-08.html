<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 8 - Tutorial - Woc.ts</title>
    <link rel="stylesheet" href="/woc.ts/theme/main.css">
  </head>
  <body class="ob-bgGreyArea">
    <header class="SiteHeader">
      <div class="ob-pageWrapper pos large">
        <div class="SiteHeader-left"><a href="/woc.ts/" class="BlockLink light">Woc.ts</a></div>
        <div class="SiteHeader-right"><a href="/woc.ts/presentation.html" class="BlockLink light">Presentation</a><a href="/woc.ts/tutorial/step-00.html" class="BlockLink light noMargin">Tutorial</a></div>
      </div>
    </header>
    <div class="PageBody ob-pageWrapper large">
      <main class="PageBody-main">
        <div class="Paper side ob-text longTitle"><h1 id="step-8-todos-list-with-the-model">Step 8 - <code>Todos.List</code>: With the model</h1>
<h2 id="use-the-model-in-list-ts-">Use the model in <code>List.ts</code></h2>
<p>In the directory <code>Todos.List.wocc/</code>, edit the file <code>List.ts</code>. Here is the new full code of the class:</p>
<pre><code class="lang-typescript">export class List implements Woc.Component {
  private model: Model;
  private tplData;

  constructor(private cc: WocTeam.VueComponentContext) {
    this.model = cc.getService(&#39;Todos.Model&#39;);
    this.tplData = {
      tasks: this.model.listTasks()
    };
  }

  public attachTo(el: HTMLElement): void {
    this.cc.bindTemplate({
      el: el,
      wocTemplate: &#39;TodosList&#39;,
      data: this.tplData,
      methods: {
        rmTask: (id) =&gt; {
          this.removeItem(id);
        }
      }
    });
  }

  public refresh() {
    var newList = this.model.listTasks(),
      targetList = this.tplData.tasks,
      targetI;
    for (var curI = 0, len = newList.length; curI &lt; len; ++curI) {
      // - Add
      if (!targetList[curI]) {
        targetList.push(newList[curI]);
        continue;
      }
      // - Remove until the current id
      if (targetList[curI].id !== newList[curI].id) {
        targetI = curI + 1;
        while (targetList[targetI] &amp;&amp; targetList[targetI].id !== newList[curI].id)
          ++targetI;
        targetList.splice(curI, targetI - curI);
        // - Not found -&gt; Add
        if (!targetList[curI]) {
          targetList[curI] = newList[curI];
          continue;
        }
      }
      // - Update
      if (targetList[curI].title !== newList[curI].title)
        targetList[curI].title = newList[curI].title;
    }
    // - Remove from end
    if (targetList.length &gt; curI)
      targetList.splice(curI, targetList.length - curI);
  }

  private removeItem(id: number): void {
    this.model.rmTask(id);
    this.refresh();
  }
}
</code></pre>
<p>The model is received in the constructor. It serves to populate the template data <code>tplData</code>. Notice that the model returns a copy of the data. With Vue.js as template engine, itâ€™s important to preserve the original because Vue.js modify the data object to observe it.</p>
<p>The method <code>attachTo</code> stays without modification.</p>
<p>A new method <code>refresh</code> is implemented. All the code of this method could be replaced with a single line:</p>
<pre><code class="lang-typescript">  this.tplData.tasks = this.model.listTasks();
</code></pre>
<p>But Vue.js is rudimentary. When you splice an array, Vue.js splices nodes in DOM. When you push, it pushes etc. If we simply replace the old list with a new list, then Vue.js delete all the nodes in DOM then recreates them all again. So our method <code>refresh</code> reduces the operations on the array <code>this.tplData.tasks</code>, in order to reduce the operations in DOM.</p>
<p>The method <code>removeItem</code> is updated to use the model.</p>
<h2 id="add-the-model-in-the-the-configuration">Add the model in the the configuration</h2>
<p>We have to declare that the component accesses to the model. Edit the file <code>Todos.List.wocc/component.json</code> and add:</p>
<pre><code class="lang-javascript">  <span class="string">"useServices"</span>: [<span class="string">"Todos.Model"</span>],
</code></pre>
<p>The full code of the file is now:</p>
<pre><code class="lang-javascript">{
  <span class="string">"woc"</span>: <span class="string">"0.12"</span>,
  <span class="string">"encoding"</span>: <span class="string">"UTF-8"</span>,
  <span class="string">"contextPlugins"</span>: [<span class="string">"WocTeam.VueTemplateEngine"</span>],
  <span class="string">"useServices"</span>: [<span class="string">"Todos.Model"</span>],
  <span class="string">"scripts"</span>: <span class="string">"List.js"</span>,
  <span class="string">"templates"</span>: <span class="string">"List.html"</span>,
  <span class="string">"styleSheets"</span>: <span class="string">"List.css"</span>,
  <span class="string">"name"</span>: <span class="string">"Todos.List"</span>
}
</code></pre>
<h2 id="run-in-the-browser">Run in the browser</h2>
<p>Reload the application in the browser. The list of tasks is displayed as at step 6, but data is now provided from the model.</p>

        </div>
      </main>
      <div class="PageBody-side Sidebar">
        <nav class="Widget">
          <ul class="SimpleList">
            <li class="SimpleList-li"><a href="step-00.html" class="SmallBlockLink">0 - Bootstrapping</a></li>
            <li class="SimpleList-li"><a href="step-01.html" class="SmallBlockLink">1 - Hello, World! <em>Make a Starting Point</em></a></li>
            <li class="SimpleList-li"><a href="step-02.html" class="SmallBlockLink">2 - Add a nested bundle <code>lib</code> <em>Add things from outside</em></a></li>
            <li class="SimpleList-li"><a href="step-03.html" class="SmallBlockLink">3 - A Few Styles <em>Make a Theme</em></a></li>
            <li class="SimpleList-li"><a href="step-04.html" class="SmallBlockLink">4 - <code>Todos.List</code> <em>Make a Component</em></a></li>
            <li class="SimpleList-li"><a href="step-05.html" class="SmallBlockLink">5 - <code>Todos.List</code>: Dynamic template <em>Data binding with Vue.js</em></a></li>
            <li class="SimpleList-li"><a href="step-06.html" class="SmallBlockLink">6 - Load data from the server <em>Use the service <code>Woc.HttpClient</code></em></a></li>
            <li class="SimpleList-li"><a href="step-07.html" class="SmallBlockLink">7 - <code>Todos.Model</code> <em>Make a service</em></a></li>
            <li class="SimpleList-li"><a href="step-08.html" class="SmallBlockLink">8 - <code>Todos.List</code>: With the model</a></li>
            <li class="SimpleList-li"><a href="step-09.html" class="SmallBlockLink">9 - <code>Todos.CreateTask</code> <em>A component managed by a template</em></a></li>
            <li class="SimpleList-li"><a href="step-10.html" class="SmallBlockLink">10 - <code>Todos.Start</code>: several pages <em>Use a router</em></a></li>
            <li class="SimpleList-li"><a href="step-11.html" class="SmallBlockLink">11 - <code>Todos.EditPanel</code> <em>Double bind</em></a></li>
            <li class="SimpleList-li"><a href="step-12.html" class="SmallBlockLink">12 - <code>Todos.EditPanel</code>: with dialogs <em>Use the service <code>WocTeam.Dialogs</code></em></a></li>
            <li class="SimpleList-li"><a href="step-13.html" class="SmallBlockLink">13 - <code>Todos.DateInput</code>: A custom date picker? <em>Use a jQuery-ui widget</em></a></li>
            <li class="SimpleList-li"><a href="step-14.html" class="SmallBlockLink">14 - <code>Todos.Init</code>: Globally configure jQuery-ui <em>Make an initializer</em></a></li>
            <li class="SimpleList-li"><a href="step-15.html" class="SmallBlockLink">15 - Deploy! <em>Use the tool <code>woc-make</code></em></a></li>
          </ul>
        </nav>
      </div>
    </div>
    <footer class="SiteFooter">
      <div class="ob-pageWrapper large"><span class="ph-email"></span><a href="https://www.facebook.com/tarh.paleo" class="BlockLink">Facebook</a><a href="https://github.com/tarh/woc.ts" class="BlockLink">Contribute</a><a href="https://github.com/tarh/woc-site" class="BlockLink noMargin">Improve this site</a></div>
    </footer>
    <script src="/woc.ts/js/main.js"></script>
    <script src="/woc.ts/theme/prism.js"></script>
  </body>
</html>