<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step 12 - Tutorial - Woc.ts</title>
    <link rel="stylesheet" href="/theme/main.css">
  </head>
  <body class="ob-bgGreyArea">
    <header class="SiteHeader">
      <div class="ob-pageWrapper pos large">
        <div class="SiteHeader-left"><a href="/" class="BlockLink light">Woc.ts</a></div>
        <div class="SiteHeader-right"><a href="/presentation.html" class="BlockLink light">Presentation</a><a href="/tutorial/" class="BlockLink light noMargin">Tutorial</a></div>
      </div>
    </header>
    <div class="PageBody ob-pageWrapper large">
      <main class="PageBody-main">
        <div class="Paper side ob-text longTitle"><h1 id="step-12-todos-editpanel-with-dialogs-use-the-service-wocteam-dialogs-">Step 12 - <code>Todos.EditPanel</code>: with dialogs <em>Use the service <code>WocTeam.Dialogs</code></em></h1>
<p>Letâ€™s add dialogs in our component <code>Todos.EditPanel</code>.</p>
<p>The service <code>WocTeam.Dialogs</code> shows dialog boxes based on the <a href="http://demo.agektmr.com/dialog/">HTML 5 <code>&lt;dialog&gt;</code> element</a>. The <a href="https://github.com/GoogleChrome/dialog-polyfill">polyfill</a> from the Google Chrome team is used.</p>
<h2 id="in-editpanel-ts-">In <code>EditPanel.ts</code></h2>
<p>Here is the full code of the class:</p>
<pre><code class="lang-typescript">export class EditPanel implements Woc.Component {
  private router: Woc.Router;
  private model: Todos.Model;
  private dialogs: WocTeam.Dialogs;
  private tplData = {
    task: null,
    changed: false
  };

  constructor(private cc: WocTeam.VueComponentContext) {
    this.router = cc.getService(&#39;Woc.Router&#39;);
    this.model = cc.getService(&#39;Todos.Model&#39;);
    this.dialogs = cc.getService(&#39;WocTeam.Dialogs&#39;);
  }

  public attachTo(el: HTMLElement): void {
    this.cc.bindTemplate({
      el: el,
      wocTemplate: &#39;TodosEditPanel&#39;,
      data: this.tplData,
      methods: {
        save: (e) =&gt; this.cc.logWrap(() =&gt; {
          e.preventDefault();
          this.save();
          this.close();
        }),
        remove: (e) =&gt; this.cc.logWrap(() =&gt; {
          e.preventDefault();
          this.askThenRemove();
        }),
        cancel: (e) =&gt; this.cc.logWrap(() =&gt; {
          e.preventDefault();
          this.askThenClose();
        }),
        inputHandler: () =&gt; this.cc.logWrap(() =&gt; {
          this.tplData.changed = this.isChanged();
        })
      }
    });
  }

  public setTask(taskId: number) {
    this.tplData.task = this.model.getTask(taskId);
    this.tplData.changed = false;
  }

  private close() {
    this.router.navigate(&#39;&#39;);
  }

  private isChanged(): boolean {
    if (!this.tplData.task)
      return false;
    var keys = [&#39;title&#39;, &#39;description&#39;, &#39;expirationDate&#39;],
      k: string,
      cur = this.tplData.task,
      orig = this.model.getTask(cur.id),
      changed = false;
    for (var i = 0, len = keys.length; i &lt; len; ++i) {
      k = keys[i];
      if ((cur[k] || null) !== (orig[k] || null)) {
        changed = true;
        break;
      }
    }
    return changed;
  }

  private askThenRemove() {
    if (!this.tplData.task)
      return;
    this.dialogs.confirm(&#39;Delete the task?&#39;, [
      {
        label: &#39;Cancel&#39;,
        returnValue: false,
        isCancel: true
      },
      {
        label: &#39;Delete&#39;,
        returnValue: true,
        isDefault: true
      }
    ]).then((val) =&gt; this.cc.logWrap(() =&gt; {
      if (val &amp;&amp; this.tplData.task) {
        this.model.rmTask(this.tplData.task.id);
        this.dialogs.showInfo(&#39;Task is removed!&#39;);
        this.close();
      }
    }));
  }

  private askThenClose() {
    if (!this.isChanged()) {
      this.close();
      return;
    }
    this.dialogs.confirm(&#39;Modifications will be lost&#39;, [
      {
        label: &#39;Cancel&#39;,
        returnValue: &#39;cancel&#39;,
        isDefault: true,
        isCancel: true
      },
      {
        label: &#39;Save&#39;,
        returnValue: &#39;save&#39;
      },
      {
        label: &#39;Discard&#39;,
        returnValue: &#39;discard&#39;
      }
    ]).then((val) =&gt; this.cc.logWrap(() =&gt; {
      if (val === &#39;save&#39;) {
        this.save();
        this.close();
      } else if (val === &#39;discard&#39;)
        this.close();
    }));
  }

  private save() {
    if (!this.tplData.task)
      return;
    if (this.isChanged()) {
      this.model.updateTask(this.tplData.task);
      this.dialogs.showInfo(&#39;Task is saved!&#39;);
    }
  }
}
</code></pre>
<p>The service <code>WocTeam.Dialogs</code> is received in the constructor. </p>
<p>The method <code>attachTo</code> is partially modified to call new methods <code>askThenRemove</code>, <code>askThenClose</code> and <code>save</code>. All the code about dialogs is located in these three methods.</p>
<p>Two methods from the service <code>WocTeam.Dialogs</code> are used:</p>
<ul>
<li>The method <code>confirm</code> shows a dialog box with a question, and the user choose between the configured responses. The property <code>isCancel</code> set the default choice for the Escape key. The attribute <code>isDefault</code> set the default choice for the Enter key.</li>
<li>The method <code>showInfo</code> shows a brief information message. There are other methods <code>showWarning</code> and <code>showError</code> too.</li>
</ul>
<h2 id="in-component-json-">In <code>component.json</code></h2>
<p>Edit the file <code>Todos.EditPanel.wocc/component.json</code>, then add the service <code>WocTeam.Dialogs</code>:</p>
<pre><code class="lang-javascript">  <span class="string">"useServices"</span>: [<span class="string">"Woc.Router"</span>, <span class="string">"Todos.Model"</span>, <span class="string">"WocTeam.Dialogs"</span>],
</code></pre>
<h2 id="run-in-the-browser">Run in the browser</h2>
<p>Reload the application in the browser. Open a task, write something, try to cancel and test the dialog box.</p>

        </div>
      </main>
      <div class="PageBody-side Sidebar">
        <nav class="Widget">
          <ul class="SimpleList">
            <li class="SimpleList-li"><a href="step-00.html" class="SmallBlockLink">0 - Bootstrapping</a></li>
            <li class="SimpleList-li"><a href="step-01.html" class="SmallBlockLink">1 - Hello, World! <em>Make a Starting Point</em></a></li>
            <li class="SimpleList-li"><a href="step-02.html" class="SmallBlockLink">2 - Add a nested bundle <code>lib</code> <em>Add things from outside</em></a></li>
            <li class="SimpleList-li"><a href="step-03.html" class="SmallBlockLink">3 - A Few Styles <em>Make a Theme</em></a></li>
            <li class="SimpleList-li"><a href="step-04.html" class="SmallBlockLink">4 - <code>Todos.List</code> <em>Make a Component</em></a></li>
            <li class="SimpleList-li"><a href="step-05.html" class="SmallBlockLink">5 - <code>Todos.List</code>: Dynamic template <em>Data binding with Vue.js</em></a></li>
            <li class="SimpleList-li"><a href="step-06.html" class="SmallBlockLink">6 - Load data from the server <em>Use the service <code>Woc.Ajax</code></em></a></li>
            <li class="SimpleList-li"><a href="step-07.html" class="SmallBlockLink">7 - <code>Todos.Model</code> <em>Make a service</em></a></li>
            <li class="SimpleList-li"><a href="step-08.html" class="SmallBlockLink">8 - <code>Todos.List</code>: With the model</a></li>
            <li class="SimpleList-li"><a href="step-09.html" class="SmallBlockLink">9 - <code>Todos.CreateTask</code> <em>A component managed by a template</em></a></li>
            <li class="SimpleList-li"><a href="step-10.html" class="SmallBlockLink">10 - <code>Todos.Start</code>: several pages <em>Use a router</em></a></li>
            <li class="SimpleList-li"><a href="step-11.html" class="SmallBlockLink">11 - <code>Todos.EditPanel</code> <em>Double bind</em></a></li>
            <li class="SimpleList-li"><a href="step-12.html" class="SmallBlockLink">12 - <code>Todos.EditPanel</code>: with dialogs <em>Use the service <code>WocTeam.Dialogs</code></em></a></li>
            <li class="SimpleList-li"><a href="step-13.html" class="SmallBlockLink">13 - <code>Todos.DateInput</code>: A custom date picker? <em>Use a jQuery-ui widget</em></a></li>
            <li class="SimpleList-li"><a href="step-14.html" class="SmallBlockLink">14 - <code>Todos.Init</code>: Globally configure jQuery-ui <em>Make an initializer</em></a></li>
            <li class="SimpleList-li"><a href="step-15.html" class="SmallBlockLink">15 - Deploy! <em>Use the tool <code>woc-make</code></em></a></li>
          </ul>
        </nav>
      </div>
    </div>
    <footer class="SiteFooter">
      <div class="ob-pageWrapper large"><span class="ph-email"></span><a href="https://www.facebook.com/tarh.paleo" class="BlockLink">Facebook</a><a href="https://github.com/tarh/woc.ts" class="BlockLink">Contribute</a><a href="https://github.com/tarh/woc-site" class="BlockLink noMargin">Improve this site</a></div>
    </footer>
    <script src="/js/main.js"></script>
    <script src="/theme/prism.js"></script>
  </body>
</html>